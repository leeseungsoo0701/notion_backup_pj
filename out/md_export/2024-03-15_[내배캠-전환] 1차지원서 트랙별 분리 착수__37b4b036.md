---
created_date: 2024-03-15
id: 37b4b036-750a-446c-8131-4ba4619122b0
url: https://www.notion.so/1-37b4b036750a446c81314ba4619122b0
perf_flag: yes
importance: 5
summary_5lines:
  - 🔥 atom 기본값 설정하기 (input 비어보이는 문제 해결) → ssr hydration으로 해결
  - 개선사항) 1depth 함수과 2depth 함수 헷갈림
  - firstApplication의 apl1 이 트랙마다 구성이 달라서 DTO에 ?를 쓸 수 밖에 없는 것 해결 → type 버려.. zod로 해결해
  - updateFirstApplication의 _1depthFields → 개발자가 직접 수정해야하는 것 개선하기 → 어차피 안바뀌지 않을까?….  → Object.keys로 해결
  - 두 함수 구분이 필요한 것은 맞는데, 그걸 컴포넌트 안에서 호출할때 둘 중 무엇을 호출할지 결정하려면 개발자가 직접 firstApplication 스키마를 확인하고 1depth인지 2depth인지 판단해야함
---

# 2024-03-15_[내배캠-전환] 1차지원서 트랙별 분리 착수

| Property | Value |
| --- | --- |
| created_date | 2024-03-15 |
| id | 37b4b036-750a-446c-8131-4ba4619122b0 |
| url | https://www.notion.so/1-37b4b036750a446c81314ba4619122b0 |
| perf_flag | yes |
| importance | 5 |
| summary_5lines | |
|  | - 🔥 atom 기본값 설정하기 (input 비어보이는 문제 해결) → ssr hydration으로 해결 |
|  | - 개선사항) 1depth 함수과 2depth 함수 헷갈림 |
|  | - firstApplication의 apl1 이 트랙마다 구성이 달라서 DTO에 ?를 쓸 수 밖에 없는 것 해결 → type 버려.. zod로 해결해 |
|  | - updateFirstApplication의 _1depthFields → 개발자가 직접 수정해야하는 것 개선하기 → 어차피 안바뀌지 않을까?….  → Object.keys로 해결 |
|  | - 두 함수 구분이 필요한 것은 맞는데, 그걸 컴포넌트 안에서 호출할때 둘 중 무엇을 호출할지 결정하려면 개발자가 직접 firstApplication 스키마를 확인하고 1depth인지 2depth인지 판단해야함 |

Original: https://www.notion.so/1-37b4b036750a446c81314ba4619122b0

- ▶ 목차 리스트

# 🤔  Point 

---

### 1. 확장성 ⭐⭐⭐⭐⭐
- PM님들의 놀라운 요청 대응 가능성 → **확장성** 중요

### 2. 관심사 분리 ⭐⭐⭐⭐
- **UI**를 찍어내는 부분과, **로직/데이터**와 관련있는 부분을 분리하기 

### 3. 스택 선택
- Class vs. function
- jotai vs. useReducer 

### 4. 이 리팩토링을 통해 얻을 수 있는 점 (4시) 
- UI 확장성, 질문 수정 시 쉽게 갈아끼울 수 있다.
- 한 트랙을 수정했을 때 다른 트랙이 영향을 안받는다. 
- 회고와 함께 총 정리하기 
- 각자 어떤 일 했고
  - 이전과 비교해 뭐가 좋아졌는지 정리하기 
  - 한줄씩만이라도 정리!! 
  - 코드도 잇으면 ^^& 👍

# 📔 정리

---

### 4/5 공유 내용
- 기존 로직 모두 완성
> **추가 작업 핵심 : ****UI 컴포지션 인스턴스****만 바꾸면 모든게 자동으로 바뀐다! **
- 인스턴스에 zod validation 정보 합치기 → 인스턴스를 기준으로 동적으로 zod 스키마 형성됨 
- CTA 버튼 활성화 검사에 zod 스키마 재사용
  - 생일 형식 에러나 풀타임 불가 에러는 무시하도록 예외처리 
  - 디바운스 추가해서 input 입력 시 연속해서 zod parse 일어나지 않게 방지
- CTA 따닥이 방지 로직 수정 → 제출 실패 시 버튼 다시 활성화 
- 라디오 컴포넌트
  - db에 label을 저장할건지 value를 저장할건지 설정 가능 (instance 정보에 포함) 

# ☑️ Todo

---

### 필수로 해야하는 일 (기존 로직과 동일) 💎
- [x] default 기수가 있는지 없는지 여부에 따른 지원서 모양
- [x] reference Options는 원격구성 nbc_apply1_reference_dropdown 으로부터 
- [x] 🔥 atom 기본값 설정하기 (input 비어보이는 문제 해결) → ssr hydration으로 해결
- [x] ApplyPageFirstStepInfoCheck → atom 연결하기 
- [x] 모든 값이 채워져야 버튼 색 변하도록 - CTA 활성화 함수 수정 
- [x]  cta validation 
  - [x] 생일은 message로 거르기 + 
  - [x] 레퍼런스디테일은 객체로 따로 선언하고 export 해서 사용하기
  - [x]  validation 함수 좀 간단하게 만들어두기 > 
  - [x] 디바운스 추가해 성능 개선
  - [x] 따닥이 방지 로직 수정 - 제출 실패 시 버튼 다시 활성화 
- [ ] submit 함수 
  - [x] 상위에서 first, second 내려주던거, 위치 한단계 더 내리기 
  - [x] zodSchema validation 동적
  - [x] 에러 alert 띄우기 
  - [x] 30일 이전 체크 - 30일 미만으로 남았는데 카드 없을 때 처리 
  - [x] roundID 슬랙 - 없앨지 말지 논의 필요  → 다른 처리 + 슬랙 없애기 
  - [x] 제출하기 
- [x] 이탈로그 (기존 훅 성능 확인하기)

### 추가해야하는 일 ➕
- [x] validation 개선하기 
  - [x] Instance에 zod 넣기 
  - [x] zod.parse 대신 safeParse 사용
  - [x] zodSchema를 트랙별 apl1에 맞게 동적으로 생성하기 (일원화)
- [ ] DB 저장 값의 필드 확인하는 로직 추가 
- [ ] **atom hydrate와 composition 더 강하게 결합 가능할지?**
  - [ ] **만약 한쪽이 바뀌면 나머지 한 쪽이 바뀌어야한다는 것을 알 수 있는 로직 추가**
  - [ ] atom과 zod 연결하거나,,, 

### 하면 좋은 일 👍 (아쉬운 점)
- [ ] **필드 이름 상수화 → 실행**
- [ ] ~~firstApplication의 apl1 이 트랙마다 구성이 달라서 DTO에 ?를 쓸 수 밖에 없는 것 해결 → type 버려.. zod로 해결해~~
- [ ] updateFirstApplication의 _1depthFields → 개발자가 직접 수정해야하는 것 개선하기 → 어차피 안바뀌지 않을까?….  → Object.keys로 해결 
- [x] 드롭다운 레퍼런스 원격구성 → instance 만들어서 유진님이 해결
- [ ] atom에 불필요한 필드까지 모두 있는게 아쉽다. (atom 초기값 만드는 함수에서 트랙별로 다르게 세팅해도 될 듯) 
- [ ] 스크롤 (제일 마지막에 시간 남으면하기 - 지금 당장 안필요)
  - 만약에 한다면 document.getElementById 같은걸 써야할듯 (ref 말고) 
- 로딩 컴포넌트 → PM님께 여쭤보기 

## 기존 작업 기능 listed
- ▶ ApplyPageFirstStepFormMolecule 에서 하던 기능
  default 기수가 없는 경우에 대한 처리
  1차지원서 default 값 만들기
  페이지 이탈로그
  제출 버튼 클릭시 isSubmitted 상태 사용해서 비활성화
  지원한 기수가 마감 종료 30일 이전인지확인
  default RoundId가 없는 경우에 슬랙 보내기 (-> 플랫폼 개발팀에서 수정 필요 + 더 가져갈지 논의하기)
  reference 값을 원격구성으로 가져오기
  값이 다 채워지지 않으면 cta 비활성화 (기존 로직은 카드여부, round, reference, refDetail 만 체크했었는데 전체 값다 확인하는 식으로 제어 필요 )
  지원서의 트랙과 일치하는 모집가능한 라운드를 추출 (trackOptions)
  submitHandler
  - e.preventDefault 처리
  - 트랙별 스키마 뽑아서 zod Parse
    - 이때 parse에 성공하더라도 30일 이전 + 카드가 없는 경우 실패 처리
    - parse에 실패하는 경우 zod에러 보여주기
    - parse에 성공하는 경우 isSubmitted 상태 바꾸고, submit 하기
  - 로그 logApply1View(track);
  백엔드 트랙의 경우 트랙 선택 부분이 기본정보 위에 존재
모든 트랙에서 name, phone, birthday는 '신청정보' 내에 공통으로 존재
'간단설문' 내에 트랙별로 아래 질문 들을 radio 버튼으로 렌더링
- IOS, ANDROID이면 'currentOccupation','sameMajor','programmingLevel','goalToAchieve','hasCard',
- UXUI, DATA 이면
'currentOccupation', 'sameMajor', 'hasCard'
- BACKEND이면
'currentOccupation', 'programmingLevel', 'roundId', 'hasCard'
- 그 외
'currentOccupation', 'programmingLevel', 'hasCard'
  - 이때 radio 버튼에서 사용할 값들은 별도의 객체에서 가져옴
  - radio 버튼 이후에는 reference 값을 dropdown 형태로 가져옴
  최하단 graybox에서 isFullTimePossible 학습 여부를 묻는 질문 존재
- ▶ radio 컴포넌트 체크리스트
  - hasCard와 roundId 항목은 value 값으로 (boolean, id) 저장되고
  - 그 외 나머지 항목들은 값 자체로 저장됨
  - 백엔드인 경우 roundId 하단에 트랙 추천 컴포넌트 추가 (클릭 시 로그 전송 후 채널톡 링 오픈)
  ```markup
  async function handleClickTrackConsultingButton() {
  window.open(process.env.CHANNEL_TALK_LINK, '_blank');
  await sendLog('nbc_application1_contact_click');
  }
  ```
  - 백엔드 툴팁 메세지 .
- ▶ dropdown 체크리스트
  내일배움카드 hasCard 앞에 넘버링
특정 응답일 때 detail 인풋 오픈

# 🗒️  memo

---
- ▶ Record<TrackType, []>의 객체로 1차 지원서 표현
  ```javascript
  const INPUT = 'input'
  const TEXT_AREA = 'textarea'
  const RADIO = 'radio'
  const BUTTONS = 'buttons'
  
  type questionType  = typeof INPUT | typeof TEXT_AREA | typeof RADIO | typeof BUTTONS
  interface questionObject {
  	type : questionType;
  	name: string
  }
  const App1QuestionComposition : Record<TrackType, {
  }> = {
  	[BACKEND] : [
  			{ 
  				section : "기본정보",
  				questions: [nameInput, birthDayInput, phoneNumberInput] 
  			},
  			{
  				section : "간단설문",
  				questions: [occupationRadio, sameMajorRadio, referenceDropdown, hasCardButton] 
  			}
  			],
  	[FRONTEND] : ... 
  }
  
  const nameInput = new Input("name")
  const birthDayInput = new Input("birthday", birthdayFormatter, )
  const phoneNumberInput = new Input("phoneNumber", phoneNumberFormatter)
  const occupationRadio = new Radio(
  															"currentOccupation", 
  															"현재 직업을 알려주세요", 
  															[ { label: currentOccupationOptions.jobSeeker },{ label: currentOccupationOptions.student },{ label: currentOccupationOptions.worker },])
  const sameMajorRadio = new Radio(
  														"currentOccupation", 
  														'관련 전공을 졸업하시거나 재학 중이신가요?',
  														[{ label: sameMajorOptions.yes }, { label: sameMajorOptions.no }]
  
  const devLevelRadio = new Radio(
  														"programmingLevel",
  														'나의 개발 수준을 선택해 주세요.',
  													 [
  													  { label: programmingLevelOptions.newbie },
  													  { label: programmingLevelOptions.basic },
  													  { label: programmingLevelOptions.intermediate },
  													  { label: programmingLevelOptions.advanced },
  													  ],
  													) 
  
  const referenceDropdown = new Dropdown(
  		'내일배움카드가 있으신가요?',
  		'카드가 없어도 괜찮아요. 발급 방법을 직접 안내드려요.',
  		[
  		    { value: true, label: '네, 있어요.' },
  		    { value: false, label: '아니요, 없어요.' },
  		  ],
  )
  const hasCardButton = new Buttons(
  		'내일배움카드가 있으신가요?',
  		'카드가 없어도 괜찮아요. 발급 방법을 직접 안내드려요.',
  		[
  		    { value: true, label: '네, 있어요.' },
  		    { value: false, label: '아니요, 없어요.' },
  		  ],
  )
  ```
- ▶ zod로부터 타입 추론
  > 💡 type을 먼저 작성하는 게 아니라.. 
zod로 부터 타입을 추론하는 것도 가능.. 
    ```javascript
    const User = z.object({
      username: z.string(),
    });
    
    // z로부터 타입을 추론
    type User = z.infer<typeof User>; // { username: string }
    ```
- ▶ onSubmit 핸들러가 하는 일이 너무 많다. 
  onsubmit 핸들러가 하는 일이 너무 많아서 가독성이 떨어짐 (validation + 스크롤 이동 + 슬랙 보내기 + 제출)
→ 위 기능들을 한눈에 볼 수 있도록 적절히 나누는 것도 중요할 것 같음 
- ▶ zod.parse 대신 zod.safeParse
  - zod.parse 대신 zod.**safeParse**를 쓰고 값을 사용하자
- [x] ** 개선사항) layout shift 줄이기 - 레퍼런스 빼고 일단 기본값으로 미리 그리기 **
- [x] 개선사항) 기본값이 업데이트 되는 장면이 노출됨 > 보기 안좋다. (jotai 기본값 설정의 한계) 
- [x] **개선사항) 1depth 함수과 2depth 함수 헷갈림**
  - ~~두 함수 구분이 필요한 것은 맞는데, 그걸 컴포넌트 안에서 호출할때 둘 중 무엇을 호출할지 결정하려면 개발자가 직접 firstApplication 스키마를 확인하고 1depth인지 2depth인지 판단해야함~~
  - ~~그냥 name과 value만 넣어서 호출하면~~
  - ~~**함수 안에서 알아서 1depth인지 2depth인지 구분해서 업데이트 해주면 더 좋지 않을까? **~~
- 파일 위치에 대한 고민
  - 필요 로직이 너무 멀리있는 것은 아닌가 싶음.
  - 사용되는 곳에서 가까지 있으면 좋을 것 같은데, 이렇게 나눈 이유가 또 있긴 하겠찌… 

# 💻  History

---
- ▶ 놀이터 박제
  https://prod-files-secure.s3.us-west-2.amazonaws.com/83c75a39-3aba-4ba4-a792-7aefe4b07895/f985962c-03eb-496f-8e88-9c29bf8bc334/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666GGI3V4S%2F20250911%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250911T080146Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIH36vuC2TiY9NiBs4WhZI4j4Z%2BisyDeznAniUwvqxnksAiEAuZ8gJ5vqVFpVZCAHrRMr%2BpcCI8rWMZyM6m9M4DsDdT4q%2FwMIEBAAGgw2Mzc0MjMxODM4MDUiDNqivDvxItzbXkiQRSrcA%2FqWvn1AW9eYC9bWL9cyW7Mwx45Cbva8f8aJQs%2BrVDa%2FVVry%2BUM7EHPcE54y9647%2BFESf1aKAvqxMcpF4IivUwAHoSlDOq7dvoF1dPn7%2BceKMq%2FSsyB5oIy2BiVlwQYvsX%2Fyg%2B0yjfFiJyVb0S4FXN8tFHD7NA1KHyiJBoLHtlmerptBYqeTzFv9qEIOKClyveWr2MUEHRrLXOE9j7uGwc4HlX4MxzKl6DM1J00GtgLboMiHtPlN8OVZqYqS15H2au8%2Bk%2FqR2sh0uBjzrjWBh5p%2B389zqLty0cpSZvPPjaO8dKlzPtZNH7jBRu%2Fr4oHwnK8lJLmqaYoTxj8FfmcwjwP1w8pVAPXQGVh5bfC1S3eYKmjGxTj0gcIbf1JlxrWt%2BA%2BM2aLPF9xHGa5nJX315IEwYp0TPc2cDDDZ8YcaPB9DuW%2Fz6iRChsyaxWy51ZehXVMZ3ArWxrH8JZ0VzkC%2FWtmHutJxou57EuaxydrUPj3awMG3jEfgdB77gL%2BnDDbrJ%2BifpVC8QswJFtdnaV%2BVLYFvacMkve9OFySa0BNF1eW58ynzGmw%2BlnWiiKLga0aBkrBv%2BYekpwNZ7wgRkQuBDFLLFlIoRzEZB8SK3UjZdpQcqBWIBgKNw9RWVo5UMPHticYGOqUBxIxmIQyEnjZHf2L%2FcJQAHQI5qg0tcjixeGhE96nztXZsLHyimQGGIcsIu2JA2vTO8wGPx5dMzId5qCCfspCsaLqpVZlVCHM6wXra2Io2KHVA5uoEsXP8YAmH1J6C5JpqELjq6qTkHGDABHg11WITn89ip%2BrfaKbQj2FdAPBxMHwvJMX%2FUsYjHq8n7g2KusYVZr329CRGv40QZaYMVr1qtspSBOlN&X-Amz-Signature=2eefe00d81518f1e66c5750bf34a2d6bc4d3058c9643dd06d069cdb1eaf033c1&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject

## Databases

### Database: fb5be74e-95e6-4a78-abe8-16bc8b4a24af

| 개발자 | 날짜 | 작업 내용 | notion_url |
| --- | --- | --- | --- |
|  |  |  | https://www.notion.so/53f54d3432cd4b51bbb61356e982e347 |
| 유진 |  | instance 기반 UI 템플릿 아키텍처  | https://www.notion.so/instance-UI-8c37d77462c24fd19c315df358380574 |
| 다윤 | 2024-04-02 | input, radio, dropdown에 atom 연결 | https://www.notion.so/input-radio-dropdown-atom-77ffddacdea84a9e9452479ec5c1f3cd |
| 다윤 | 2024-03-29 | jotai vs useReducer 결정 과정 | https://www.notion.so/jotai-vs-useReducer-cd147f1f453248968bfb3c6f212b359d |
| 다윤 | 2024-04-01 | jotai 선택 / jotai atom 세팅 | https://www.notion.so/jotai-jotai-atom-e3b4a29d65db4fb6806a79925e6d86ad |
